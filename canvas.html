<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>May's Canvas</title>
		<link rel="stylesheet" href="canvas.css">
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
		<script>

			//set all variables
			var canvasWidth = 600;
			var canvasHeight = 400;
			var clickX = new Array();
			var clickY = new Array();
			var clickDrag = new Array();
			var paint;
			var colorPurple = '#660099';
			var colorBlue = '#3333CC';
			var colorGreen = '#336633';
			var colorYellow = '#FFFF33';
			var colorPink = '#CC0099';
			var clickColor = new Array();
			var curColor = colorPurple;
			var clickSize = new Array();
			var curSize = 10;
			var clickTool = new Array();
			var curTool = null;
			var clickAlpha = new Array();
			var curAlpha = 1;

			$(document).ready(function() {

				//set 2d context
				context = document.getElementById('canvas').getContext('2d');

				//set height and width of canvas
				$('#canvas').attr({
					width: canvasWidth,
					height: canvasHeight
				});

				//set borders on default options on page load
				$('#purple, #normal, #marker').addClass('highlight');

				//drawing - on mousedown
				$(document).on('mousedown', '#canvas', function(e) {
					var mouseX = e.pageX - this.offsetLeft;
					var mouseY = e.pageY - this.offsetTop;
					paint = true;
					addClick(mouseX, mouseY);
					redraw();
				});
					
				//drawing - on mousemove
				$(document).on('mousemove', '#canvas', function(e) {
					if(paint) {
						var mouseX = e.pageX - this.offsetLeft;
						var mouseY = e.pageY - this.offsetTop;
						addClick(mouseX, mouseY, true);
						redraw();
					}
				});

				//drawing - on mouseup
				$(document).on('mouseup', '#canvas', function(e) {
					paint = false;
				});

				//drawing - on mouse leaving the canvas
				$(document).on('mouseleave', '#canvas', function(e) {
					paint = false;
				});

				//drawing - on mouse re-entering the canvas - WORK ON THIS!!!?
				// $(document).on('mouseenter', '#canvas', function(e) {
				// 	paint = true;
				// });

				//add click function
				function addClick(x, y, dragging)
				{
					if(curTool == "eraser") {
						curColor = "white";
					}	
					clickX.push(x);
					clickY.push(y);
					clickDrag.push(dragging);
					clickColor.push(curColor);
					clickSize.push(curSize);
					clickTool.push(curTool);
					clickAlpha.push(curAlpha);
				}

				//redraw function
				function redraw() {
					context.clearRect(0, 0, canvasWidth, canvasHeight);
					context.lineJoin = "round";
					for(var i=0; i<clickX.length; i++) {
						context.beginPath();
						if(clickDrag[i] && i) {
							context.moveTo(clickX[i-1], clickY[i-1]);
						} else {
							context.moveTo(clickX[i]-1, clickY[i]);
						}
						context.lineTo(clickX[i], clickY[i]);
						context.closePath();
						context.strokeStyle = clickColor[i];
						context.lineWidth = clickSize[i];
						context.globalAlpha = clickAlpha[i];
						context.stroke();
					}
				}

				//add highlight class for border
				function highlight(choice) {
					var choice_class = choice.attr('class').substr(7,10);
					$('.' + choice_class).removeClass('highlight');
					$(choice).addClass('highlight');
				}

				//change current color when click on colors in color picker
				$(document).on('click', '#purple', function() {
					curColor = colorPurple;
					highlight($(this));
				});
				$(document).on('click', '#blue', function() {
					curColor = colorBlue;
					highlight($(this));
				});
				$(document).on('click', '#green', function() {
					curColor = colorGreen;
					highlight($(this));
				});
				$(document).on('click', '#yellow', function() {
					curColor = colorYellow;
					highlight($(this));
				});
				$(document).on('click', '#pink', function() {
					curColor = colorPink;
					highlight($(this));
				});

				//change current font weight when click on options in font weight picker
				$(document).on('click', '#small', function() {
					curSize = 4;
					highlight($(this));
				});
				$(document).on('click', '#normal', function() {
					curSize = 10;
					highlight($(this));
				});
				$(document).on('click', '#large', function() {
					curSize = 17;
					highlight($(this));
				});
				$(document).on('click', '#huge', function() {
					curSize = 23;
					highlight($(this));
				});

				//change current tool when click on options in tool picker
				$(document).on('click', '#marker', function() {
					curTool = 'marker';
					curAlpha = 1;
					if(curColor == 'white') {
						curColor = colorPurple;
					}
					highlight($(this));
				});
				$(document).on('click', '#crayon', function() {
					curTool = 'crayon';
					curAlpha = 0.4;
					if(curColor == 'white') {
						curColor = colorPurple;
					}
					highlight($(this));
				});
				$(document).on('click', '#eraser', function() {
					curTool = 'eraser';
					curAlpha = 1;
					highlight($(this));
					$('.choice_col').removeClass('highlight');
				});

				// //change color of font weight options depending on current color - use this or not???
				// $(document).on('click', '.choice_col', function() {
				// 	if(curColor==colorPurple) {
				// 		$('.line').css('background-color', colorPurple);
				// 	} else if(curColor==colorBlue) {
				// 		$('.line').css('background-color', colorBlue);
				// 	} else if(curColor==colorGreen) {
				// 		$('.line').css('background-color', colorGreen);
				// 	} else if(curColor==colorYellow) {
				// 		$('.line').css('background-color', colorYellow);
				// 	} else if(curColor==colorPink) {
				// 		$('.line').css('background-color', colorPink);
				// 	}
				// });

				//draggable test
				$(".draggable").draggable();

				$(document).on('mousedown', '.draggable', function() {
					$('#drag_picker').append("<div class='choice drag_choice draggable'>drag</div>");
					$(".draggable").draggable();
				});
				
				//clear canvas when click clear button (confirm first)
				$(document).on('click', '#clear', function() {
					if(confirm('Are you sure you want to clear the canvas?')) {
						clearCanvas();
					}
				});

				//clear canvas function - clears canvas and resets all arrays
				function clearCanvas()
				{
					context.clearRect(0, 0, canvasWidth, canvasHeight);
					clickX.length = 0;
					clickY.length = 0;
					clickDrag.length = 0;
					clickColor.length = 0;
					clickSize.length = 0;
				}
			});
		</script>
	</head>
	<body>
		<!-- canvas -->
		<canvas id="canvas"></canvas> 
		<!-- color picker -->
		<div class="picker">
			<div class="choice choice_col" id="purple"></div>
			<div class="choice choice_col" id="blue"></div>
			<div class="choice choice_col" id="green"></div>
			<div class="choice choice_col" id="yellow"></div>
			<div class="choice choice_col" id="pink"></div>
			<button id="clear">Clear</button>
		</div>
		<!-- font weight picker -->
		<div class="picker">
			<div class="choice choice_wgt" id="small"><div class="line" id="line_small"></div></div>
			<div class="choice choice_wgt" id="normal"><div class="line" id="line_normal"></div></div>
			<div class="choice choice_wgt" id="large"><div class="line" id="line_large"></div></div>
			<div class="choice choice_wgt" id="huge"><div class="line" id="line_huge"></div></div>
		</div>
		<!-- tool picker -->
		<div class="picker">
			<div class="choice choice_tol" id="marker">marker</div>
			<div class="choice choice_tol" id="crayon">crayon</div>
			<div class="choice choice_tol" id="eraser">eraser</div>
		</div>
		<!-- stamps -->
		<div class="picker" id="drag_picker">
			<div class = "choice choice_drag draggable">drag</div>
		</div>



	</body>
</html>