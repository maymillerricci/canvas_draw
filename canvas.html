<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>May's Canvas</title>
		<link rel="stylesheet" href="canvas.css">
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script>

			//set all variables
			var canvasWidth = 600;
			var canvasHeight = 400;
			var clickX = new Array();
			var clickY = new Array();
			var clickDrag = new Array();
			var paint;
			var colorPurple = '#660099';
			var colorBlue = '#3333CC';
			var colorGreen = '#336633';
			var colorYellow = '#FFFF33';
			var colorPink = '#CC0099';
			var clickColor = new Array();
			var curColor = colorPurple;
			var clickSize = new Array();
			var curSize = 10;
			var clickTool = new Array();
			var curTool = null;
			var clickAlpha = new Array();
			var curAlpha = 1;
			var curMode = 'draw';

			$(document).ready(function() {

				//set 2d context
				context = document.getElementById('canvas').getContext('2d');

				//set height and width of canvas
				$('#canvas').attr({
					width: canvasWidth,
					height: canvasHeight
				});

				//set borders on default options on page load
				$('#purple, #normal, #marker, #draw').addClass('highlight');

				//on mousedown - different actions for drawing, line, circle, rectangle modes - WORK ON!!!
				$(document).on('mousedown', '#canvas', function(e) {
						e.preventDefault();
						var mouseX = e.pageX - this.offsetLeft;
						var mouseY = e.pageY - this.offsetTop;
					if(curMode == 'draw') {
						paint = true;
					} else if(curMode == 'line') {
				        if(needFirstPoint) {
					        // context.beginPath();
					        // context.moveTo(mouseX, mouseY);
					        needFirstPoint = false;
			    		}
				    	else {
				        	context.lineTo(mouseX, mouseY);
				        	context.strokeStyle = curColor;
							context.lineWidth = curSize;
							context.globalAlpha = curAlpha;
				        	context.stroke();
				        	needFirstPoint = true;
				    	} 
				    } else if(curMode == 'rectangle') {
				    		var mouseA = e.pageX - this.offsetLeft;
							var mouseB = e.pageY - this.offsetTop;
							// console.log(mouseA);
				        if(needFirstPoint) {
					        // context.beginPath();
					        // context.moveTo(mouseX, mouseY);
					        needFirstPoint = false;
					        return mouseA;
			    		}
				    	else {
				    		// console.log(mouseA);
				    		context.rect(mouseX, mouseY, mouseA, mouseB);
				        	context.strokeStyle = curColor;
							context.lineWidth = curSize;
							context.globalAlpha = curAlpha;
				        	context.stroke();
				        	needFirstPoint = true;
				    	}
					} else if(curMode == 'circle') {
				        if(needFirstPoint) {
					        // context.beginPath();
					        // context.moveTo(mouseX, mouseY);
					        needFirstPoint = false;
			    		}
				    	else {
				    		// console.log(mouseX);
				    		// console.log(mouseY);
				    		// arc(x,y,r,start,stop)
				    		context.arc(mouseX, mouseY, 50, 0, 2*Math.PI);
				        	// context.arc(mouseX, mouseY, 100, 0, 2*Math.PI);
				        	context.strokeStyle = curColor;
							context.lineWidth = curSize;
							context.globalAlpha = curAlpha;
				        	context.stroke();
				        	needFirstPoint = true;
				    	}
					} 
					addClick(mouseX, mouseY);
					redraw();
				});

				//drawing - on mousemove
				$(document).on('mousemove', '#canvas', function(e) {
					if(paint) {
						addClick(e.pageX - this.offsetLeft, e.pageY - this.offsetTop, true);
						redraw();
					}
				});

				//drawing - on mouseup
				$(document).on('mouseup', '#canvas', function(e) {
					paint = false;
				});

				//drawing - on mouse leaving the canvas
				$(document).on('mouseleave', '#canvas', function(e) {
					paint = false;
				});

				//drawing - on mouse re-entering the canvas - WORK ON THIS!!!
				// $(document).on('mouseenter', '#canvas', function(e) {
				// 	paint = true;
				// });

				//add click function
				function addClick(x, y, dragging)
				{
					if(curTool == "eraser") {
						curColor = "white";
					}	
					clickX.push(x);
					clickY.push(y);
					clickDrag.push(dragging);
					// if(curTool == "eraser") {
					// 	clickColor.push("white");
					// } 
					// else {
					// 	clickColor.push(curColor);
					// }
					clickColor.push(curColor);
					clickSize.push(curSize);
					clickTool.push(curTool);
					clickAlpha.push(curAlpha);
				}

				//redraw function
				function redraw() {
					// context.clearRect(0, 0, canvasWidth, canvasHeight); //comment out makes crayon not work, comment in makes line not work
					context.lineJoin = "round";
					for(var i=0; i<clickX.length; i++) {
						context.beginPath();
						if(clickDrag[i] && i) {
							context.moveTo(clickX[i-1], clickY[i-1]);
						} else {
							context.moveTo(clickX[i]-1, clickY[i]);
						}
						context.lineTo(clickX[i], clickY[i]);
						context.closePath();
						context.strokeStyle = clickColor[i];
						context.lineWidth = clickSize[i];
						context.globalAlpha = clickAlpha[i];
						context.stroke();
					}
					// if(curTool == "crayon") {
    	// 				context.globalAlpha = 0.4;
    	// 				context.drawImage(crayonTextureImage, 0, 0, canvasWidth, canvasHeight);
  			// 		}
  			// 		else {
  			// 			context.globalAlpha = 1;
  			// 		}
				}

				//add highlight class - CAN THIS BE DONE BETTER IN FUNCTIONS?
				// function highlight(thing) {
				// 	$('.choice').removeClass('highlight');
				// 	$(thing).addClass('highlight');
				// }

				//change current color when click on colors in color picker
				$(document).on('click', '#purple', function() {
					curColor = colorPurple;
					$('.color_choice').removeClass('highlight');
					$(this).addClass('highlight');
				});
				$(document).on('click', '#blue', function() {
					curColor = colorBlue;
					$('.color_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});
				$(document).on('click', '#green', function() {
					curColor = colorGreen;
					$('.color_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});
				$(document).on('click', '#yellow', function() {
					curColor = colorYellow;
					$('.color_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});
				$(document).on('click', '#pink', function() {
					curColor = colorPink;
					$('.color_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});

				//change current font weight when click on options in font weight picker
				$(document).on('click', '#small', function() {
					curSize = 5;
					$('.weight_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});
				$(document).on('click', '#normal', function() {
					curSize = 15;
					$('.weight_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});
				$(document).on('click', '#large', function() {
					curSize = 25;
					$('.weight_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});
				$(document).on('click', '#huge', function() {
					curSize = 35;
					$('.weight_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});

				//change current tool when click on options in tool picker
				$(document).on('click', '#marker', function() {
					curTool = 'marker';
					curAlpha = 1;
					if(curColor == 'white') {
						curColor = colorPurple;
					}
					$('.tool_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});
				$(document).on('click', '#crayon', function() {
					curTool = 'crayon';
					curAlpha = 0.4;
					if(curColor == 'white') {
						curColor = colorPurple;
					}
					$('.tool_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});
				$(document).on('click', '#eraser', function() {
					curTool = 'eraser';
					curAlpha = 1;
					$('.tool_choice').removeClass('highlight');
					$('.color_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});

				//change mode when click on options in mode picker
				$(document).on('click', '#draw', function() {
					curMode = 'draw';
					needFirstPoint = true;
					$('.mode_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});
				$(document).on('click', '#line', function() {
					curMode = 'line';
					curAlpha = 1;
					needFirstPoint = true;
					$('.mode_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});
				$(document).on('click', '#rectangle', function() {
					curMode = 'rectangle';
					curAlpha = 1;
					needFirstPoint = true;
					$('.mode_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});
				$(document).on('click', '#circle', function() {
					curMode = 'circle';
					curAlpha = 1;
					needFirstPoint = true;
					$('.mode_choice').removeClass('highlight');
					$(this).addClass('highlight')
				});

				//change color of font weight options depending on current color
				// $(document).on('click', '.color_choice', function() {
				// 	if(curColor==colorPurple) {
				// 		$('.line').css('background-color', colorPurple);
				// 	} else if(curColor==colorBlue) {
				// 		$('.line').css('background-color', colorBlue);
				// 	} else if(curColor==colorGreen) {
				// 		$('.line').css('background-color', colorGreen);
				// 	} else if(curColor==colorYellow) {
				// 		$('.line').css('background-color', colorYellow);
				// 	} else if(curColor==colorPink) {
				// 		$('.line').css('background-color', colorPink);
				// 	}
				// });
				
				//clear canvas when click clear button (confirm first)
				$(document).on('click', '#clear', function() {
					if(confirm('Are you sure you want to clear the canvas?')) {
						clearCanvas();
					}
				});

				//clear canvas function - clears canvas and resets all arrays
				function clearCanvas()
				{
					context.clearRect(0, 0, canvasWidth, canvasHeight);
					clickX.length = 0;
					clickY.length = 0;
					clickDrag.length = 0;
					clickColor.length = 0;
					clickSize.length = 0;
					// clickTool.length = 0;
				}
			});
		</script>
	</head>
	<body>
		<!-- canvas -->
		<canvas id="canvas" width="600" height="400"></canvas> 
		<!-- color picker -->
		<div class="picker">
			<div class="choice color_choice" id="purple"></div>
			<div class="choice color_choice" id="blue"></div>
			<div class="choice color_choice" id="green"></div>
			<div class="choice color_choice" id="yellow"></div>
			<div class="choice color_choice" id="pink"></div>
			<button id="clear">Clear</button>
		</div>
		<!-- font weight picker -->
		<div class="picker">
			<div class="choice weight_choice" id="small"><div class="line" id="line_small"></div></div>
			<div class="choice weight_choice" id="normal"><div class="line" id="line_normal"></div></div>
			<div class="choice weight_choice" id="large"><div class="line" id="line_large"></div></div>
			<div class="choice weight_choice" id="huge"><div class="line" id="line_huge"></div></div>
		</div>
		<div class="picker">
			<div class="choice tool_choice" id="marker">marker</div>
			<div class="choice tool_choice" id="crayon">crayon</div>
			<div class="choice tool_choice" id="eraser">eraser</div>
		</div>
		<div class="picker">
			<div class="choice mode_choice" id="draw">draw</div>
			<div class="choice mode_choice" id="line">line</div>
			<div class="choice mode_choice" id="rectangle">rectangle</div>
			<div class="choice mode_choice" id="circle">circle</div>
		</div>



	</body>
</html>